# Employee vs Profile Differentiation Guide

## Overview
This document clarifies the distinction between **Employees** (EmployeesHub) and **Profiles** (User with profile role) in the HRMS system, including their unique identifiers and use cases.

## Core Concepts

### Employees (EmployeesHub Collection)
Full-time or part-time staff members who are part of the organization's regular workforce.

### Profiles (User Collection with role='profile')
Temporary or non-permanent workers such as interns, trainees, and contract workers who primarily need certificate management.

## Detailed Comparison

| Aspect | Employee (EmployeesHub) | Profile (User - profile role) |
|--------|------------------------|-------------------------------|
| **Unique ID** | `employeeId` (EMP-XXXX) | `VTID` (VT1234) |
| **Database Collection** | EmployeesHub | User |
| **ID Format** | EMP-1001, EMP-1002, ... | VT1001, VT1234, VT5678 |
| **Auto-generation** | ✅ On creation | ✅ On creation |
| **Can Clock In/Out** | ✅ Yes | ❌ No |
| **Has Shifts/Rota** | ✅ Yes | ❌ No |
| **Manager Relationship** | ✅ Yes (via managerId) | ❌ No |
| **Organizational Chart** | ✅ Yes | ❌ No |
| **Time Tracking** | ✅ Full support | ❌ Not tracked |
| **Leave Management** | ✅ Full support | ❌ Not tracked |
| **Expense Claims** | ✅ Can submit | ❌ Not applicable |
| **Certificate Management** | ✅ Supported | ✅ Primary purpose |
| **Department Assignment** | ✅ Yes | Optional |
| **Reports/Exports** | ✅ Included | ❌ Excluded |
| **Authentication** | Via linked User account | Direct User account |

## ID System Details

### Employee ID (employeeId)

**Format:** `EMP-XXXX`
- Examples: EMP-1001, EMP-1002, EMP-1150

**Generation:**
- Auto-generated via pre-save hook in EmployeesHub model
- Finds highest existing number and increments by 1
- Always padded to 4 digits

**Location:**
```javascript
// backend/models/EmployeesHub.js
employeeHubSchema.pre('save', async function(next) {
  if (!this.employeeId && this.isNew) {
    const lastEmployee = await this.constructor.findOne({}, { employeeId: 1 })
      .sort({ employeeId: -1 }).lean();
    let nextId = 1001;
    if (lastEmployee && lastEmployee.employeeId) {
      const match = lastEmployee.employeeId.match(/EMP-(\d+)/);
      if (match) nextId = parseInt(match[1]) + 1;
    }
    this.employeeId = `EMP-${String(nextId).padStart(4, '0')}`;
  }
  next();
});
```

**Usage:**
- Employee lists and directories
- Reports and exports (CSV, PDF)
- Organizational chart
- Time entry records
- Leave records
- Expense claims
- Manager assignments

**Display:**
Always show `employeeId` when referencing employees in the UI.

### VTID (Verification Trainee ID)

**Format:** `VT1234`
- Examples: VT1001, VT2345, VT9876

**Generation:**
- Auto-generated via pre-save hook in User model
- Random 4-digit number between 1000-9999
- Ensures uniqueness with retry logic (max 100 attempts)

**Location:**
```javascript
// backend/models/User.js
userSchema.pre('save', async function(next) {
  if (!this.vtid && this.isNew) {
    const generateVTID = () => {
      const min = 1000;
      const max = 9999;
      return Math.floor(Math.random() * (max - min + 1)) + min;
    };

    let vtid;
    let isUnique = false;
    let attempts = 0;
    const maxAttempts = 100;

    while (!isUnique && attempts < maxAttempts) {
      vtid = `VT${generateVTID()}`;
      const existing = await this.constructor.findOne({ vtid });
      if (!existing) {
        isUnique = true;
      }
      attempts++;
    }

    if (!isUnique) {
      throw new Error('Unable to generate unique VTID after multiple attempts');
    }

    this.vtid = vtid;
  }
  next();
});
```

**Usage:**
- Profile identification
- Certificate management
- Notifications (for profile users)
- Profile-specific views
- Training records

**Display:**
Always show `VTID` when referencing profiles in the UI.

### MongoDB ObjectId (_id)

**Format:** 24-character hexadecimal string
- Example: 507f1f77bcf86cd799439011

**Generation:**
- Auto-generated by MongoDB
- Unique across all collections

**Usage:**
- Database primary keys
- Internal references (employee field in TimeEntry)
- API route parameters
- Authentication context

**Display:**
❌ **Never show to end users**. Always replace with `employeeId` or `VTID`.

## Data Models

### EmployeesHub Schema (Simplified)
```javascript
{
  employeeId: "EMP-1001",        // Auto-generated
  firstName: "John",
  lastName: "Doe",
  email: "john.doe@company.com",
  department: "IT",
  position: "Developer",
  managerId: ObjectId("..."),    // Reference to another EmployeeHub
  user: ObjectId("..."),         // Reference to User for auth
  // ... other employee fields
}
```

### User Schema (Profile) (Simplified)
```javascript
{
  vtid: "VT1234",                // Auto-generated
  firstName: "Jane",
  lastName: "Smith",
  email: "jane.smith@company.com",
  role: "profile",
  profileType: "intern",         // intern, trainee, contract-trainee
  startDate: "2025-01-01",
  endDate: "2025-06-30",
  institution: "University Name",
  course: "Computer Science",
  // ... other profile fields
}
```

## Use Cases

### When to Create an Employee (EmployeesHub)

✅ **Create Employee when:**
- Hiring full-time staff
- Hiring part-time staff
- Hiring contract workers who need time tracking
- Adding staff who need to clock in/out
- Adding staff who need shift assignments
- Adding staff who submit leave requests
- Adding staff who report to managers
- Adding staff included in reports

### When to Create a Profile (User - profile role)

✅ **Create Profile when:**
- Onboarding interns
- Adding trainees
- Adding contract trainees
- Need certificate management only
- Temporary workers not requiring time tracking
- Users who only need document/certificate access
- Training program participants

## Frontend Implementation Guidelines

### Displaying IDs

**Employee Lists:**
```jsx
{employees.map(emp => (
  <div key={emp._id}>
    <h3>{emp.firstName} {emp.lastName}</h3>
    <p>ID: {emp.employeeId}</p>  {/* Show employeeId, not _id */}
  </div>
))}
```

**Profile Lists:**
```jsx
{profiles.map(profile => (
  <div key={profile._id}>
    <h3>{profile.firstName} {profile.lastName}</h3>
    <p>VTID: {profile.vtid}</p>  {/* Show VTID, not _id */}
  </div>
))}
```

**Reports/Exports:**
```javascript
// CSV Export - Employees
const csvData = employees.map(emp => ({
  'Employee ID': emp.employeeId,  // NOT emp._id
  'Name': `${emp.firstName} ${emp.lastName}`,
  'Department': emp.department,
  // ... other fields
}));

// Don't include profiles in employee reports
```

### Navigation and Routing

**Employee Detail Pages:**
```javascript
// Use employeeId in URL
<Route path="/employees/:employeeId" element={<EmployeeDetail />} />

// Fetch by employeeId
await axios.get(`/api/employees/by-id/${employeeId}`);
```

**Profile Detail Pages:**
```javascript
// Use MongoDB _id in URL (or VTID if endpoint supports it)
<Route path="/profiles/:id" element={<ProfileDetail />} />

// Fetch by _id (or VTID)
await axios.get(`/api/profiles/${id}`);
```

## Backend Implementation Guidelines

### API Endpoints

**Employee Endpoints:**
```javascript
// Get employee by employeeId (preferred)
router.get('/employees/by-id/:employeeId', async (req, res) => {
  const employee = await EmployeeHub.findOne({ 
    employeeId: req.params.employeeId 
  });
});

// Get employee by MongoDB _id (internal use)
router.get('/employees/:id', async (req, res) => {
  const employee = await EmployeeHub.findById(req.params.id);
});
```

**Profile Endpoints:**
```javascript
// Get profile by VTID (preferred)
router.get('/profiles/by-vtid/:vtid', async (req, res) => {
  const profile = await User.findOne({ 
    vtid: req.params.vtid,
    role: 'profile'
  });
});

// Get profile by MongoDB _id (internal use)
router.get('/profiles/:id', async (req, res) => {
  const profile = await User.findById(req.params.id);
});
```

### TimeEntry References

**Always reference employee field:**
```javascript
// Creating time entry for employee
const timeEntry = new TimeEntry({
  employee: employeeHub._id,  // MongoDB _id reference
  date: '2025-12-08',
  clockIn: new Date(),
  // ... other fields
});

// Querying time entries
const entries = await TimeEntry.find({ employee: employeeId })
  .populate('employee', 'firstName lastName employeeId department');
```

**Profiles should not have time entries:**
```javascript
// Don't create TimeEntry for profiles
if (user.role === 'profile') {
  return res.status(403).json({ 
    message: 'Profiles cannot clock in/out' 
  });
}
```

### Certificate Management

**Both employees and profiles can have certificates:**
```javascript
// Certificate schema supports both
const certificate = new Certificate({
  ownerType: isEmployee ? 'employee' : 'profile',
  employeeRef: isEmployee ? employee._id : null,
  profileRef: isProfile ? profile._id : null,
  // ... other fields
});
```

## Common Mistakes to Avoid

❌ **Don't:**
1. Show MongoDB `_id` to end users
2. Use `_id` in reports or exports
3. Create time entries for profiles
4. Add profiles to organizational chart
5. Assign shifts/rotas to profiles
6. Use inconsistent ID fields (e.g., 'userId', 'profileId')
7. Allow profiles to clock in/out
8. Include profiles in employee reports

✅ **Do:**
1. Always display `employeeId` for employees
2. Always display `VTID` for profiles
3. Use `_id` only for internal references
4. Check user type before allowing time tracking
5. Separate profile and employee lists in UI
6. Use appropriate endpoints for each type
7. Validate user type before operations
8. Keep employee and profile features separate

## Migration Checklist

If you need to migrate existing data:

### For Employees
- [ ] Ensure all EmployeesHub records have `employeeId`
- [ ] Run migration script: `node backend/scripts/assignEmployeeIds.js`
- [ ] Verify all exports use `employeeId`
- [ ] Check all UI displays show `employeeId`
- [ ] Verify TimeEntry.employee references are correct

### For Profiles
- [ ] Ensure all profile users have `VTID`
- [ ] VTID auto-generation is already implemented in User model
- [ ] Verify profiles don't have time entries
- [ ] Check profiles aren't in organizational chart
- [ ] Verify certificate ownership uses correct references

## Testing Checklist

- [ ] Create new employee → verify `employeeId` generated
- [ ] Create new profile → verify `VTID` generated
- [ ] Employee can clock in/out
- [ ] Profile cannot clock in/out
- [ ] Employee shows in reports with `employeeId`
- [ ] Profile shows in certificate lists with `VTID`
- [ ] Employee can be added to org chart
- [ ] Profile cannot be added to org chart
- [ ] MongoDB `_id` never shown to users
- [ ] All API responses use correct ID fields

## Related Files

### Backend
- `backend/models/EmployeesHub.js` - Employee model with employeeId generation
- `backend/models/User.js` - User/Profile model with VTID generation
- `backend/models/TimeEntry.js` - Time tracking (employees only)
- `backend/models/Certificate.js` - Certificate management (both types)
- `backend/scripts/assignEmployeeIds.js` - Migration script for employee IDs

### Frontend
- All employee-related pages should display `employeeId`
- All profile-related pages should display `VTID`
- Report components should filter and format correctly
- List components should show appropriate ID field

## Support

If you encounter issues with ID generation or differentiation:

1. Check the relevant model pre-save hooks
2. Verify database indexes are correct
3. Check for duplicate IDs in database
4. Review API endpoints for correct field usage
5. Inspect frontend components for _id display

## Last Updated
December 8, 2025
